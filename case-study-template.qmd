---
title: "Your Informative Title Here"
author: "Dani Justo and Zoe Khan"
date: "Case Study 1: March 5, 2025"
format: 
  pdf:
    keep-tex: true
    include-in-header: 
       text: |
         \usepackage{fvextra}
         \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
         \DefineVerbatimEnvironment{OutputCode}{Verbatim}{breaklines,commandchars=\\\{\}}
    geometry: 
      - left=1in
      - right=1in
      - top=1in
      - bottom=1in
---
# Introduction
The 2000 U.S. presidential race was a highly contested election between Al Gore and George W. Bush, with the latter eventually winning by a hair due to Florida voters. However, something strange was afoot: people noticed that the "butterfly" ballot design for Palm Beach county in Florida was associated with a very high vote percentage for another candidate, Pat Buchanan. It was theorized that the ballot design led people to inadvertently vote for Buchanan instead of Gore. Our goal in this report is to analyze the relationship between votes for Bush and Buchanan in order to predict how many votes were potentially miscast.

```{r, echo = FALSE}
library(tidyverse)
library(Sleuth2)      
library(kableExtra) 
library(performance)
library(broom)
library(equatiomatic)
library(kable)
```

```{r, echo = FALSE}
# Loading the case study data
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

# Creating scatterplot of the linear model
ggplot(data = election_wo_pb, aes(x = log(Bush2000), y = log(Buchanan2000))) +
  geom_point() +
  labs(x = "Votes for Bush", y = "Votes for Buchanan") +
  geom_smooth(method = lm, se = FALSE)

# Logged model
model <- lm(log(Buchanan2000) ~ log(Bush2000), data = election_wo_pb)
summary(model)

# Checking conditions
check_model(model, check = c("linearity", "homogeneity", "qq"))

# Making prediction interval
palm_beach <- data.frame(Bush2000 = c(152846))
augment(model, newdata = palm_beach, interval = "prediction")
lower <- exp(5.52)
fitted <- exp(6.38)
upper <- exp(7.24)

equation <- extract_eq(model, use_coefs = TRUE)
```

Data Description

## Ask about what summary statistics should be included!!!

For our data analysis, we used the The "Dramatic U.S. Presidential Election of 2000" data set from the `Sleuth2` package. This data set includes the number of votes for Buchanan and Bush in all 67 counties in Florida during the 2000 U.S. presidential election. We want to see if the confusing "butterfly" layout of the ballot used in palm beach county caused the discrepancy in votes between Bush and Buchanan, so we've removed palm beach county from our data set. This allows us to observe relationship between Bush and Buchanan's votes under "normal" circumstances, namely, if the election really hadn't been affected by the ballot.

*I'll talk about these summary statistics here*

```{r, echo = FALSE}
summary_statistics <- election_wo_pb |> 
  summarize(mean_bush = mean(Bush2000),
            mean_buch = mean(Buchanan2000),
            median_bush = median(Bush2000),
            median_buch = median(Buchanan2000))
kable(summary_statistics)
```


The scatter plot displayed below has a correlation coefficient of 0.867, suggesting a strong positive association between the number of votes for Bush and the number of votes for Buchanan. The $R^2$ of the linear regression model is 0.862 indicates that the number of votes for Bush account for 86.2% of the variability in the number of votes for Buchanan.

```{r, echo = FALSE}
ggplot(data = election_wo_pb, aes(x=Bush2000, 
                                  y=Buchanan2000))  + 
  geom_point() + 
  labs(title = " 2000 election Votes for Bush Vs. Votes for Buchanan in Florida Counties",
       x = "# of Votes for Bush",
       y = "# of Votes for Buchanan")
```


*Your written short report should be the first thing your reader encounters in your case study document. While you may choose to label each of the required components/sections of the short report with its own header (see below for an example of creating a header in Quarto), you do not need to do so provided that all of the required information is included. Your report should be self-contained and written in such a way that a quantitatively inclined friend (who has taken or is taking SDS 291) could follow what you did without necessarily knowing anything about the U.S. presidential election of 2000.*

*As you write your report, you may wish to reference the guide to typesetting regression lines in Quarto using LaTeX (linked at the top of our class Moodle page), the Quarto help page for formatting documents using Markdown (https://quarto.org/docs/authoring/markdown-basics.html), and the Quarto help page for customizing the output from executed code chunks (https://quarto.org/docs/computations/execution-options.html).*

```{r}
#| include: false

# The written short report component of your case study should not have any visible R code, and the only R output that should be included are relevant plots and nicely formatted tables. Of course, this means that the R code to generate those figures/tables must be included *somewhere* in the Quarto .qmd document, but remain hidden from the reader! 
#   We can accomplish this using chunk options, like the include: false option above.
#   This tells Quarto to run and execute the code, but to exclude both the code and any associated output from the rendered PDF document.

# Loading necessary packages
library(tidyverse)
library(Sleuth2)      # the package containing the data for the case study
library(kableExtra)   # for creating nicely formatted tables in Quarto

# Loading the case study data
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

# Loading another dataset on wine consumption and heart disease mortality (deaths per 1000 individuals), just as an example
wine <- Sleuth2::ex0823
```

### An example section heading

*When you create plots for your case study report, the `echo: false` chunk option tells Quarto to include the final output of your R commands (in this case, a plot) in your rendered PDF without* printing the underlying R commands that generated that plot! The message and warning flags both prevent R from printing any additional text with error messages or warnings to the PDF.

```{r}
#| echo: false
#| message: false
#| warning: false

wine |> ggplot(aes(x = Wine, y = Mortality)) + geom_point() + ggtitle("Association between wine consumption and mortality rates.")
```

*When reporting the results of your regression analysis, I would like you to write out a mathematical description of the main/final population model for the mean. Here is an example of what that might look like:*

Let $mort_i$ denote the heart disease mortality rate in country $i$ (measured in deaths per 1,000 individuals) and $wine_i$ denote the consumption of wine (measured in liters per person per year). Our final linear regression model is $$E[mort_i | wine_i] = \beta_0 + \beta_1\left(wine_i\right).$$

*You do not need to write out the fitted regression line, but you should (at a minimum) provide a table summarizing the estimated coefficients of the model and their corresponding standard errors, like the one shown below. A print-out from the `summary()` command alone is not sufficient.*

```{r}
#| echo: false

# Fitting the regression line for mean mortality as a function of wine consumption
wine_lm <- lm(Mortality ~ Wine, data = wine)

# Representing the regression table as a dataframe (i.e., tidying the summary() output)
wine_lm_table <- summary(lm.wine)$coefficients

# Creating a nicely formatted table from the dataframe using the kable package
#   You can find more information about this package here: https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf
wine_lm_table |> kbl(col.names = c("Name for Col. 1", "Name for Col. 2", "Name for Col. 3", "Name for Col. 4"), align = "c", booktabs = T, linesep="", digits = c(2, 2, 2, 4)) |> kable_classic(full_width = F, latex_options = c("HOLD_position"))

```

# R Appendix

*Copy and paste all code that you used for your case study into one chunk at the end of your written report. Before submitting your case study, take one final look at the R Appendix and make sure that all code is clearly visible. If you see a line running off the side of the PDF, please split the code over multiple lines using a linebreak. The header at the top of this template should ensure that lines of code are automatically wrapped in your final document.*

```{r}
#| message: FALSE
#| warning: FALSE

# Loading necessary packages
library(tidyverse)
library(Sleuth2)
library(broom)        
library(kableExtra)   

# Loading the data for case study one
election <- Sleuth2::ex0825

# Creating a second dataset with Palm Beach County excluded
election_wo_pb <- election |> filter(County != "Palm Beach")

# Loading another dataset on wine consumption and heart disease mortality
wine <- Sleuth2::ex0823

# Creating a scatterplot for the relationship between mortality and wine consumption
wine |> ggplot(aes(x = Wine, y = Mortality)) + geom_point() + 
  ggtitle("Association between wine consumption and mortality rates.")

# Fitting and summarizing the regression line for mean mortality 
# as a function of wine consumption
wine.lm <- lm(Mortality ~ Wine, data = wine)
wine.lm.table <- wine.lm |> tidy()
wine.lm.table |> kbl(col.names = c("Name for Col. 1", "Name for Col. 2", 
                                   "Name for Col. 3", "Name for Col. 4", 
                                   "Name for Col. 5"), 
                     align = "c", booktabs = T, linesep="", 
                     digits = c(2, 2, 2, 4)) |> 
  kable_classic(full_width = F, latex_options = c("HOLD_position"))
```
